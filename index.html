<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Virtual Booth</title>
  <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Schoolbell&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Chewy', cursive;
      background: url('BG%20DEMO.png') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #startScreen, #cameraScreen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #startScreen {
      display: flex;
    }

    #cameraContainer {
      position: relative;
      width: 90%;
      max-width: 360px;
    }

    video, canvas {
      width: 100%;
      border-radius: 16px;
      object-fit: cover;
      object-position: center;
    }

    .slider {
      display: flex;
      overflow-x: auto;
      width: 100%;
      max-width: 360px;
      margin-top: 10px;
    }

    .slider button {
      flex: 0 0 auto;
      width: 60px;
      height: 60px;
      margin: 5px;
      border-radius: 50%;
      border: 2px solid #1e88e5;
      background-color: white;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .slider button.selected {
      transform: scale(1.2);
      background-color: #1e88e5;
      color: white;
    }

    button.control {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #1e88e5;
      color: white;
      font-family: 'Chewy', cursive;
      cursor: pointer;
    }

    #loading {
      position: fixed;
      width: 100%;
      height: 100%;
      background: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-family: 'Chewy', cursive;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="loading">Loading...</div>

<div id="startScreen">
  <button class="control" onclick="startApp()">Start</button>
</div>

<div id="cameraScreen">
  <div id="cameraContainer">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <div class="slider" id="sliderButtons"></div>

  <button class="control" id="capture">Capture</button>
  <button class="control" id="retry" style="display:none;" onclick="location.reload()">Retake</button>
  <a id="download" class="control" style="display:none;">Download Photo</a>
</div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const slider = document.getElementById('sliderButtons');
  const captureButton = document.getElementById('capture');
  const downloadLink = document.getElementById('download');
  const loadingScreen = document.getElementById('loading');

  let stream;
  let selectedIndex = 0;

  const backgrounds = ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png'];
  const frames = ['frame1.png', 'frame2.png', 'frame3.png', 'frame4.png', 'frame5.png', 'frame6.png'];

  function startApp() {
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('cameraScreen').style.display = 'flex';
    document.body.style.filter = 'blur(5px)';
    startCamera();
  }

  async function startCamera() {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
      video.srcObject = stream;
      video.play().catch(() => {
        loadingScreen.innerHTML = 'Camera failed to start. Please refresh.';
      });

      video.onloadedmetadata = () => {
        loadingScreen.style.display = 'none';
        setupSlider();
      };

    } catch (error) {
      loadingScreen.innerHTML = 'Unable to access camera. Please check permissions.';
      console.error(error);
    }
  }

  function setupSlider() {
    for (let i = 0; i < backgrounds.length; i++) {
      const btn = document.createElement('button');
      btn.innerText = i + 1;
      btn.onclick = () => selectBackgroundFrame(i);
      slider.appendChild(btn);
    }
    selectBackgroundFrame(0);
  }

  function selectBackgroundFrame(index) {
    selectedIndex = index;
    Array.from(slider.children).forEach((btn, idx) => {
      btn.classList.toggle('selected', idx === index);
    });
  }

  captureButton.addEventListener('click', () => {
    const context = canvas.getContext('2d');
    const width = video.videoWidth;
    const height = video.videoHeight;
    canvas.width = width;
    canvas.height = height;

    context.filter = 'brightness(1.1) contrast(1.1) saturate(1.2)';
    context.drawImage(video, 0, 0, width, height);

    const bg = new Image();
    bg.src = backgrounds[selectedIndex];
    bg.onload = () => {
      context.globalCompositeOperation = 'destination-over';
      context.drawImage(bg, 0, 0, width, height);

      const frame = new Image();
      frame.src = frames[selectedIndex];
      frame.onload = () => {
        context.globalCompositeOperation = 'source-over';
        context.drawImage(frame, 0, 0, width, height);

        const text = prompt('Enter your name/message:');
        if (text) {
          context.font = "48px 'Schoolbell', cursive";
          context.fillStyle = 'white';
          context.strokeStyle = 'black';
          context.lineWidth = 3;
          context.textAlign = 'center';
          context.strokeText(text, width / 2, height - 60);
          context.fillText(text, width / 2, height - 60);
        }

        canvas.style.display = 'block';
        video.style.display = 'none';
        captureButton.style.display = 'none';
        downloadLink.href = canvas.toDataURL('image/png');
        downloadLink.style.display = 'inline-block';
      };
    };
  });
</script>

</body>

</html>
